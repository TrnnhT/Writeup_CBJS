FROM php:7.2-apache

# Install necessary packages
RUN apt-get update && apt-get install -y libpq-dev && docker-php-ext-install pgsql pdo pdo_pgsql

# Set the working directory for the web app
WORKDIR /var/www/html/

# Copy the web app files and flag to the container
COPY ./src .
COPY flag /flag_d8f2

# Set permissions for the owner of the files
RUN chown -R root:www-data .
RUN chmod 750 .
RUN find . -type f -exec chmod 640 {} \;
RUN find . -type d -exec chmod 750 {} \;
 
# Add sticky bit to prevent delete files
RUN chmod +t -R .

# Set up additional scripts
RUN echo "#!/bin/bash\necho 'Installing server ...'" >> /opt/install.sh
RUN chmod +x /opt/install.sh