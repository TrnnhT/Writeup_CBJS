<?php
/*
 * Index 
 */

session_start();
include 'database.php';

// Default language when first time access to site
$language = 'vi';

// Change `current language` via get parameter then save it to Cookie 
if (isset($_GET["lang"])) {
  $language = $_GET["lang"];
  unset($_COOKIE);
  setcookie('lang', $language, time() + 60 * 60 * 24 * 30, '/', $_SERVER['SERVER_NAME']);
}

// Get `current language` via Cookie
if (isset($_COOKIE['lang'])) {
  $language = $_COOKIE['lang'];
}

// Fetch data according to `current language`
$result = pg_query($db, "SELECT id, title, content, link FROM news WHERE language = '$language'");
$row = pg_fetch_row($result);
?>

<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>CBJS News</title>

  <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css" />
  <link rel="stylesheet" href="assets/vendors/aos/dist/aos.css/aos.css" />

  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
  <?php if ($language === 'en') {
    $label = 'Detail';
  } else if ($language === 'vi') {
    $label = 'Chi tiáº¿t bÃ i viáº¿t';
  } ?>
  <div class="container-scroller">
    <div class="main-panel">
      <!-- partial:partials/_navbar.html -->
      <header id="header">
        <div class="container">
          <nav class="navbar navbar-expand-lg navbar-light">
            <div class="navbar-bottom p-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <a class="navbar-brand" href="/" style="font-size:2.25rem; font-weight: bolder; color: white">CYBERJUTSU News</a>
                </div>
                <div>
                  <button class="navbar-toggler" type="button" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="navbar-collapse justify-content-center collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav d-lg-flex justify-content-between align-items-center">
                      <li>
                        <button class="navbar-close">
                          <i class="mdi mdi-close"></i>
                        </button>
                      </li>
                      <li class="nav-item active">
                        <a class="nav-link" href="/">Home</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Languages</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="index.php?lang=vi">ðŸ‡»ðŸ‡³</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="index.php?lang=en">ðŸ‡ºðŸ‡¸</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <!-- partial -->
      <div class="content-wrapper">
        <div class="container">
          <div class="row" data-aos="fade-up">
            <div class="col-xl-12 stretch-card grid-margin">
              <div class="position-relative">
                <img src="assets/images/dashboard/img_1.jpg" alt="banner" class="img-fluid" />
                <div class="banner-content">
                  <div class="badge badge-danger fs-12 font-weight-bold mb-3">
                    Breaking News
                  </div>
                  <h1 class="mb-0"><?php echo $row[1] ?></h1>
                  <h2 class="mb-2"><?php echo '<a class="text-decoration-none" href="' . $row[3] . '">' . $label . '</a>' ?></h2>
                </div>
              </div>
            </div>
          </div>
          <div class="row" data-aos="fade-up">
            <div class="col-lg-12 stretch-card grid-margin">
              <div class="card">
                <div class="card-body">

                  <?php
                  while ($row = pg_fetch_row($result)) {
                    echo '
                    <div class="row">
                      <div class="col-sm-4 grid-margin">
                        <div class="position-relative">
                          <div class="rotate-img">
                            <a href="' . $row[3] . '">
                              <img src="assets/images/news/new_' . $row[0] . '.jpg" alt="thumb" class="img-fluid"/>
                            </a>
                          </div>
                          <div class="badge-positioned">
                            <span class="badge badge-danger font-weight-bold">Flash news</span>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-8  grid-margin">
                        <h2 class="mb-2 font-weight-600">' . $row[1] . '</h2>
                        <p class="mb-2">' . $row[2] . '</p>
                        <a class="text-decoration-none" href="' . $row[3] . '"> <b>' . $label . '</b> </a>
                      </div>
                    </div>';
                  } ?>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- main-panel ends -->
    </div>
  </div>
  <script src="assets/vendors/js/vendor.bundle.base.js"></script>
  <script src="assets/vendors/aos/dist/aos.js/aos.js"></script>
  <script src="./assets/js/demo.js"></script>
</body>

</html>